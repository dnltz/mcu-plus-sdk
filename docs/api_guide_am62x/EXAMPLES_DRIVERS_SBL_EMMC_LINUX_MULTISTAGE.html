<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM62x MCU+ SDK: SBL EMMC Linux Multistage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM62x MCU+ SDK
   &#160;<span id="projectnumber">09.01.00</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_DRIVERS_SBL_EMMC_LINUX_MULTISTAGE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SBL EMMC Linux Multistage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md966">Introduction</a></li>
<li class="level1"><a href="#autotoc_md967">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md968">Steps to Run the Example</a><ul><li class="level2"><a href="#autotoc_md969">Build the example</a></li>
<li class="level2"><a href="#autotoc_md970">Create Linux Appimage</a></li>
<li class="level2"><a href="#autotoc_md971">Create HSM Appimage</a></li>
<li class="level2"><a href="#autotoc_md972">Run the example</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md973">See Also</a></li>
<li class="level1"><a href="#autotoc_md974">Sample Output</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_drivers_sbl_emmc_linux_multistage"></a> </p><dl class="section note"><dt>Note</dt><dd>SBL EMMC Linux boots from the boot partition 1 of eMMC and does not use a filesystem boot. The appimage is flashed to the offsets in eMMC as configured using syscfg. </dd></dl>
<dl class="section attention"><dt>Attention</dt><dd>Care should be taken to ensure that the R5, M4 appimage and the Linux appimage flashed does NOT overwrite the Linux binaries in eMMC. </dd></dl>
<dl class="section note"><dt>Note</dt><dd>The load address of resource table for R5 and M4 cores must be consistant with the address in the Linux dts file.</dd></dl>
<h1><a class="anchor" id="autotoc_md966"></a>
Introduction</h1>
<p>This is a bootloader example, which shows an example of booting Linux on A53 core and RTOS/NORTOS applications on R5 and M4 cores from eMMC.</p>
<p>The booting is done in 2 stages(2 bootloader applications).</p><ul>
<li>The stage1 of the bootloader runs from the HSM RAM. It boots MCU M4 with RTOS/NORTOS application and initializes the DDR. Then it loads the stage2 of the bootloader to DDR and stats running it.</li>
<li>The stage2 of the bootloader boots Linux on A53 and then self loads DM firmware on the DM R5.</li>
</ul>
<p>The SBL uses 6 appimages</p><ul>
<li>A Linux appimage containing the <b>Linux binaries (ATF, OPTEE, A53 SPL)</b>.</li>
<li>tiboot3.bin with <b>SBL stage1, TIFS, BoardConfig</b></li>
<li>Appimage for <b>SBL stage2</b></li>
<li>Appimage for <b>MCU M4</b></li>
<li>Appimage for <b>HSM M4</b></li>
<li>DM firmware appimage for <b>DM R5</b></li>
</ul>
<p>The bootloader does SOC initializations and parses the multicore appimage present in eMMC boot partition 1, splits it into RPRCs for each core applicable. Each core is then initialized, RPRC image is loaded, entry points are set and the core is released from reset.</p>
<p>For booting Linux, SBL parses the Linux appimage present in eMMC boot partition, splits it into individual linux binaries (ATF, OPTEE, SPL). SBL loads the Linux binaries, entry point is set to the start address of ATF and A53 core is released from reset.</p>
<p>Refer <a class="el" href="SBL_BOOTING_LINUX_EMMC.html">SBL Booting Linux From eMMC</a> for more details on the EMMC bootflow.</p>
<p>Refer <a class="el" href="DRIVERS_DDR_PAGE.html#ENABLE_DDR_INLINE_ECC">Enabling DDR inline ECC</a> enablig inline ECC</p>
<h1><a class="anchor" id="autotoc_md967"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0 nortos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Board  </td><td class="markdownTableBodyNone">am62x-sk, am62x-sk-lp, am62x-sip-sk   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/drivers/boot/sbl_emmc_linux_multistage   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md968"></a>
Steps to Run the Example</h1>
<h2><a class="anchor" id="autotoc_md969"></a>
Build the example</h2>
<ul>
<li><b>When using CCS projects to build</b>, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li><b>When using makefiles to build</b>, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
</ul>
<h2><a class="anchor" id="autotoc_md970"></a>
Create Linux Appimage</h2>
<dl class="section note"><dt>Note</dt><dd>Change DEVICE_TYPE to HS in ${SDK_INSTALL_PATH}/devconfig/devconfig.mak and then generate Linux Appimage for HS-SE device.</dd></dl>
<ul>
<li>Create a Linux Appimage containing the <b>Linux binaries (ATF, OPTEE, A53 SPL)</b></li>
<li>This can be done by running the makefile at {SDK_INSTALL_PATH}/tools/boot/linuxAppimageGen after setting the PSDK path in file <code>config.mak</code></li>
<li>Refer <a class="el" href="TOOLS_BOOT.html#LINUX_APPIMAGE_GEN_TOOL">Linux Appimage Generator Tool</a> for more details</li>
</ul>
<h2><a class="anchor" id="autotoc_md971"></a>
Create HSM Appimage</h2>
<ul>
<li>Create a HSM Appimage</li>
<li>This can be done by running the makefile at {SDK_INSTALL_PATH}/tools/boot/HSMAppimageGen</li>
<li>Refer <a class="el" href="TOOLS_BOOT.html#HSM_APPIMAGE_GEN_TOOL">HSM Appimage Generator Tool</a> for more details</li>
</ul>
<h2><a class="anchor" id="autotoc_md972"></a>
Run the example</h2>
<ul>
<li>This example is the SBL which needs to be flashed on the eMMC, along with sample application images for R5, M4 CPUs and Linux Appimage.</li>
<li>There is a default flash config file as shown below which flashes this SBL and the IPC RPMsg Linux echo applications <pre class="fragment">  ${SDK_INSTALL_PATH}/tools/boot/sbl_prebuilt/am62x-sk/default_sbl_emmc_linux.cfg
</pre></li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Use <b>default_sbl_emmc_linux_hs.cfg</b> when flashing to HS-SE devices</dd>
<dd>
Use <b>default_sbl_emmc_linux_hs_fs.cfg</b> when flashing to HS-FS devices<ul>
<li>Make sure IPC rpmsg linux echo application is built before running the flash script. (see <a class="el" href="EXAMPLES_DRIVERS_IPC_RPMESSAGE_LINUX_ECHO.html">IPC RP Message Linux Echo</a>)</li>
</ul>
</dd>
<dd>
For IPC rpmsg linux echo, the resource table entity must be placed at the beginning of remoteproc memory section as mentoined in Linux dts file.</dd></dl>
<ul>
<li>To flash to the EVM, refer to <a class="el" href="GETTING_STARTED_FLASH.html">Flash an example application</a> . Only when giving the flash config file, point to the <code>default_sbl_emmc_linux.cfg</code> shown above.</li>
<li>Example, assuming SDK is installed at <code>C:/ti/mcu_plus_sdk</code> and this example and IPC application is built using makefiles, and Linux Appimage is already created, in Windows, <pre class="fragment">  cd C:/ti/mcu_plus_sdk/tools/boot
  python uart_uniflash.py -p COM13 --cfg=C:/ti/mcu_plus_sdk/tools/boot/sbl_prebuilt/am62x-sk/default_sbl_emmc_linux.cfg
</pre></li>
<li>If Linux PC is used, assuming SDK is installed at `~PSDK_LINUX_HS_IMAGE_PATH~/ti/mcu_plus_sdk/tools/boot/sbl_prebuilt/am62x-sk//default_sbl_emmc_linux.cfg</li>
<li>Boot the EVM in eMMC boot mode to boot Linux on A53 and RTOS/Baremetal application on R5 and M4 cores.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>The above config file will flash till u-boot on the EMMC bootmedia. U-Boot can load kernel from any bootmedia, refer to <a href="https://software-dl.ti.com/processor-sdk-linux/esd/AM62X/latest/exports/docs/devices/AM62X/linux/Overview.html"><b>Processor SDK Linux</b></a> user guide for more details.</dd></dl>
<h1><a class="anchor" id="autotoc_md973"></a>
See Also</h1>
<p><a class="el" href="DRIVERS_BOOTLOADER_PAGE.html">BOOTLOADER</a></p>
<h1><a class="anchor" id="autotoc_md974"></a>
Sample Output</h1>
<p>After flashing and booting the EVM, you will see below output on the UART console (Complete log is not shown)</p>
<pre class="fragment">SYSFW Version 9.0.5--v09.00.05 (Kool Koala)
SYSFW revision 0x9
DMSC ABI revision 3.1

[BOOTLOADER_PROFILE] Boot Media       : eMMC
[BOOTLOADER_PROFILE] Boot Media Clock : 200.000 MHz
[BOOTLOADER_PROFILE] Boot Image Size  : 157 KB
[BOOTLOADER_PROFILE] Cores present    :
m4f0-0
r5f0-0
[BOOTLOADER PROFILE] System_init                      :       6688us
[BOOTLOADER PROFILE] Drivers_open                     :      50067us
[BOOTLOADER PROFILE] Board_driversOpen                :          0us
[BOOTLOADER PROFILE] Sciclient Get Version            :       9928us
[BOOTLOADER PROFILE] App_loadImages                   :      23087us
[BOOTLOADER PROFILE] App_loadSelfcoreImage            :      24984us
[BOOTLOADER_PROFILE] SBL Total Time Taken             :     114756us

Image loading done, switching to application ...
Starting MCU-m4f and 2nd stage bootloader

SYSFW Version 9.0.5--v09.00.05 (Kool Koala)
SYSFW revision 0x9
DMSC ABI revision 3.1

[BOOTLOADER_PROFILE] Boot Media       : eMMC
[BOOTLOADER_PROFILE] Boot Media Clock : 200.000 MHz
[BOOTLOADER_PROFILE] Boot Image Size  : 940 KB
[BOOTLOADER_PROFILE] Cores present    :
hsm-m4f0-0
r5f0-0
a530-0
[BOOTLOADER PROFILE] System_init                      :       2669us
[BOOTLOADER PROFILE] Drivers_open                     :      19541us
[BOOTLOADER PROFILE] Board_driversOpen                :          1us
[BOOTLOADER PROFILE] Sciclient Get Version            :       9975us
[BOOTLOADER PROFILE] App_loadImages                   :      21374us
[BOOTLOADER PROFILE] App_loadSelfcoreImage            :      26255us
[BOOTLOADER PROFILE] App_loadLinuxImages              :      50493us
[BOOTLOADER_PROFILE] SBL Total Time Taken             :     130310us

Image loading done, switching to application ...
Starting linux and RTOS/Baremetal applications
NOTICE:  BL31: v2.8(release):v2.8-226-g2fcd408bb3-dirty
NOTICE:  BL31: Built : 00:42:57, Jan 13 2023

U-Boot SPL 2023.04-ga3595f1e3e (Jun 15 2023 - 08:14:46 +0000)
SYSFW ABI: 3.1 (firmware rev 0x0009 '9.0.5--v09.00.05 (Kool Koala)')
SPL initial stack usage: 1856 bytes
Trying to boot from MMC1
Authentication passed
Authentication passed


U-Boot 2023.04-ga3595f1e3e (Jun 15 2023 - 08:14:46 +0000)

SoC:   AM62X SR1.0 HS-FS
Model: Texas Instruments AM625 SK
EEPROM not available at 80, trying to read at 81
Board: AM62-SKEVM rev E3


.
.
.
.
.
.


_____                    _____           _         _
|  _  |___ ___ ___ ___   |  _  |___ ___  |_|___ ___| |_
|     |  _| .'| . | . |  |   __|  _| . | | | -_|  _|  _|
|__|__|_| |__,|_  |___|  |__|  |_| |___|_| |___|___|_|
            |___|                    |___|

Arago Project am62xx-evm -

Arago 2023.04 am62xx-evm -

am62xx-evm login:
</pre> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
