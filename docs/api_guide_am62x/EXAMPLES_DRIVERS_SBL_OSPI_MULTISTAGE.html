<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<link rel="shortcut icon" href="favicon.png" type="image/png">    
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.20"/>
<title>AM62x MCU+ SDK: SBL OSPI  Multistage</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<style>
.tinav {
    background: #c00;
    /* height: 41.375px; */
    height: 30px;
    }
</style>    
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
  $(document).ready(function() { init_search(); });
/* @license-end */
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="stylesheet.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 40px;">
  <td id="projectlogo"><a href="https://www.ti.com"><img alt="Logo" src="ti_logo.svg"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">AM62x MCU+ SDK
   &#160;<span id="projectnumber">09.02.01</span>
   </div>
  </td>
   <td>        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.svg"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.svg" alt=""/></a>
          </span>
        </div>
</td>
 </tr>
 </tbody>
</table>
<div class=tinav></div>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.20 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('EXAMPLES_DRIVERS_SBL_OSPI_MULTISTAGE.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">SBL OSPI Multistage </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#autotoc_md1154">Introduction</a></li>
<li class="level1"><a href="#autotoc_md1155">Supported Combinations</a></li>
<li class="level1"><a href="#autotoc_md1156">Steps to Run the Example</a><ul><li class="level2"><a href="#autotoc_md1157">Build the example</a></li>
<li class="level2"><a href="#autotoc_md1158">Create HSM Appimage</a></li>
<li class="level2"><a href="#autotoc_md1159">Run the example</a></li>
</ul>
</li>
<li class="level1"><a href="#autotoc_md1160">See Also</a></li>
<li class="level1"><a href="#autotoc_md1161">Sample Output</a></li>
</ul>
</div>
<div class="textblock"><p><a class="anchor" id="md_examples_drivers_sbl_ospi_multistage"></a> </p><dl class="section note"><dt>Note</dt><dd>The load address of resource table for R5, M4 and A53 cores must be consistant with the address.</dd></dl>
<h1><a class="anchor" id="autotoc_md1154"></a>
Introduction</h1>
<p>This is a bootloader example, which shows an example of booting RTOS/NORTOS applications on DM R5, MCU M4 and A53 cores.</p>
<p>The booting is done in 2 stages(2 bootloader applications).</p><ul>
<li>The stage1 of the bootloader runs from the HSM RAM. It boots MCU M4 with RTOS/NORTOS application and initializes the DDR. Then it loads the stage2 of the bootloader to DDR and starts running it</li>
<li>The stage2 of the bootloader boots RTOS/NORTOS on A53 and then self loads DM firmware on the DM R5.</li>
</ul>
<p>The SBL uses 6 appimages</p><ul>
<li>tiboot3.bin with <b>SBL stage1, TIFS, BoardConfig</b></li>
<li>Appimage for <b>SBL stage2</b></li>
<li>Appimage for <b>MCU M4</b></li>
<li>Appimage for <b>HSM M4</b></li>
<li>DM firmware appimage for <b>DM R5</b></li>
<li>Appimage for <b>A53</b></li>
</ul>
<h1><a class="anchor" id="autotoc_md1155"></a>
Supported Combinations</h1>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Parameter  </th><th class="markdownTableHeadNone">Value   </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">CPU + OS  </td><td class="markdownTableBodyNone">r5fss0-0 nortos   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Toolchain  </td><td class="markdownTableBodyNone">ti-arm-clang   </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">Board  </td><td class="markdownTableBodyNone">am62x-sk, am62x-sip-sk   </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">Example folder  </td><td class="markdownTableBodyNone">examples/drivers/boot/sbl_ospi_multistage   </td></tr>
</table>
<h1><a class="anchor" id="autotoc_md1156"></a>
Steps to Run the Example</h1>
<h2><a class="anchor" id="autotoc_md1157"></a>
Build the example</h2>
<p>Since this is a bootloader, the example will be run every time you boot an application using this example. It is run from a OSPI boot media unlike other examples which are usually loaded with CCS. Nevertheless, you can build this example like you do for the others using makefile or build it via CCS by importing as a project.</p>
<ul>
<li><b>When using CCS projects to build</b>, import the CCS project for the required combination and build it using the CCS project menu (see <a class="el" href="CCS_PROJECTS_PAGE.html">Using SDK with CCS Projects</a>).</li>
<li><b>When using makefiles to build</b>, note the required combination and build using make command (see <a class="el" href="MAKEFILE_BUILD_PAGE.html">Using SDK with Makefiles</a>)</li>
<li>Refer to the page <a class="el" href="TOOLS_FLASH.html#BASIC_STEPS_TO_FLASH_FILES">Basic steps to flash files</a> to flash this bootloader along with the application to boot.</li>
</ul>
<h2><a class="anchor" id="autotoc_md1158"></a>
Create HSM Appimage</h2>
<dl class="section note"><dt>Note</dt><dd>Change DEVICE_TYPE to HS in ${SDK_INSTALL_PATH}/devconfig/devconfig.mak and then generate HSM Appimage for HS-SE device.</dd></dl>
<ul>
<li>Create a HSM Appimage</li>
<li>This can be done by running the makefile at {SDK_INSTALL_PATH}/tools/boot/HSMAppimageGen</li>
<li>Refer <a class="el" href="TOOLS_BOOT.html#HSM_APPIMAGE_GEN_TOOL">HSM Appimage Generator Tool</a> for more details</li>
</ul>
<h2><a class="anchor" id="autotoc_md1159"></a>
Run the example</h2>
<ul>
<li>This example is the SBL which needs to be flashed on the EVM flash, along with sample application images for R5, M4 CPUs and A53 Appimage.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>For HS-SE device, use <b>default_sbl_ospi_hs.cfg</b> as the cfg file. </dd>
<dd>
For HS-FS device, use <b>default_sbl_ospi_hs_fs.cfg</b> as the cfg file.</dd></dl>
<ul>
<li>There is a default flash config file as shown below which flashes this SBL and the IPC RPMsg echo applications <pre class="fragment">  ${SDK_INSTALL_PATH}/tools/boot/sbl_prebuilt/am62x-sk/default_sbl_ospi_hs_fs.cfg
</pre></li>
<li>Make sure IPC rpms echo application is built before running the flash script. (see <a class="el" href="EXAMPLES_DRIVERS_IPC_RPMESSAGE_ECHO.html">IPC RP Message Echo</a>)</li>
<li>To flash to the EVM, refer to <a class="el" href="GETTING_STARTED_FLASH.html">Flash an example application</a> . Only when giving the flash config file, point to the <code>default_sbl_ospi_hs_fs.cfg</code> shown above.</li>
<li>Example, assuming SDK is installed at <code>C:/ti/mcu_plus_sdk</code> and this example and IPC application is built using makefiles, and RTOS Appimage is already created, in Windows, <pre class="fragment">  cd C:/ti/mcu_plus_sdk/tools/boot
  python uart_uniflash.py -p COM13 --cfg=C:/ti/mcu_plus_sdk/tools/boot/sbl_prebuilt/am62x-sk/default_sbl_ospi_hs_fs.cfg
</pre></li>
<li>If Linux PC is used, assuming SDK is installed at <code>~/ti/mcu_plus_sdk</code> <pre class="fragment">  cd ~/ti/mcu_plus_sdk/tools/boot
  python uart_uniflash.py -p /dev/ttyUSB0 --cfg=sbl_prebuilt/am62x-sk/default_sbl_ospi_hs_fs.cfg
</pre></li>
<li>Boot the EVM in OSPI NOR boot mode.</li>
</ul>
<h1><a class="anchor" id="autotoc_md1160"></a>
See Also</h1>
<ul>
<li><a class="el" href="DRIVERS_BOOTLOADER_PAGE.html">BOOTLOADER</a></li>
<li>Refer to <a href="https://software-dl.ti.com/processor-sdk-linux/esd/AM62X/latest/exports/docs/linux/How_to_Guides/Target/How_to_boot_quickly.html"><b>Processor SDK Linux - Boot time Optimizations</b></a> guide to optimize the time taken by bootloader in the boot sequence.</li>
</ul>
<h1><a class="anchor" id="autotoc_md1161"></a>
Sample Output</h1>
<p>After flashing and booting the EVM, you will see below output on the UART console (Complete log is not shown)</p>
<div class="fragment"><div class="line">SYSFW Firmware Version 9.2.7--v09.02.07 (Kool Koala)</div>
<div class="line">SYSFW Firmware revision 0x9</div>
<div class="line">SYSFW ABI revision 3.1</div>
<div class="line"> </div>
<div class="line">[BOOTLOADER_PROFILE] Boot Media       : FLASH</div>
<div class="line">[BOOTLOADER_PROFILE] Boot Media Clock : 166.667 MHz</div>
<div class="line">[BOOTLOADER_PROFILE] Boot Image Size  : 165 KB</div>
<div class="line">[BOOTLOADER_PROFILE] Cores present    :</div>
<div class="line">m4f0-0</div>
<div class="line">r5f0-0</div>
<div class="line">[BOOTLOADER PROFILE] System_init                      :      23124us</div>
<div class="line">[BOOTLOADER PROFILE] Board_init                       :          0us</div>
<div class="line">[BOOTLOADER PROFILE] Drivers_open                     :        295us</div>
<div class="line">[BOOTLOADER PROFILE] Board_driversOpen                :       6786us</div>
<div class="line">[BOOTLOADER PROFILE] Sciclient Get Version            :      10204us</div>
<div class="line">[BOOTLOADER PROFILE] App_waitForMcuPbist              :       4990us</div>
<div class="line">[BOOTLOADER PROFILE] App_waitForMcuLbist              :       7689us</div>
<div class="line">[BOOTLOADER PROFILE] App_loadImages                   :       3262us</div>
<div class="line">[BOOTLOADER PROFILE] App_loadSelfcoreImage            :       3972us</div>
<div class="line">[BOOTLOADER_PROFILE] SBL Total Time Taken             :      60326us</div>
<div class="line"> </div>
<div class="line">Image loading done, switching to application ...</div>
<div class="line">Starting MCU-m4f and 2nd stage bootloader</div>
<div class="line"> </div>
<div class="line">SYSFW Firmware Version 9.2.7--v09.02.07 (Kool Koala)</div>
<div class="line">SYSFW Firmware revision 0x9</div>
<div class="line">SYSFW ABI revision 3.1</div>
<div class="line"> </div>
<div class="line">[BOOTLOADER_PROFILE] Boot Media       : FLASH</div>
<div class="line">[BOOTLOADER_PROFILE] Boot Media Clock : 166.667 MHz</div>
<div class="line">[BOOTLOADER_PROFILE] Boot Image Size  : 242 KB</div>
<div class="line">[BOOTLOADER_PROFILE] Cores present    :</div>
<div class="line">hsm-m4f0-0</div>
<div class="line">r5f0-0</div>
<div class="line">a530-0</div>
<div class="line">[BOOTLOADER PROFILE] System_init                      :       2812us</div>
<div class="line">[BOOTLOADER PROFILE] Board_init                       :          0us</div>
<div class="line">[BOOTLOADER PROFILE] Drivers_open                     :        361us</div>
<div class="line">[BOOTLOADER PROFILE] Board_driversOpen                :      28043us</div>
<div class="line">[BOOTLOADER PROFILE] Sciclient Get Version            :      10265us</div>
<div class="line">[BOOTLOADER PROFILE] App_loadImages                   :       2680us</div>
<div class="line">[BOOTLOADER PROFILE] App_loadSelfcoreImage            :       4064us</div>
<div class="line">[BOOTLOADER PROFILE] App_loadA53Images                :       3675us</div>
<div class="line">[BOOTLOADER_PROFILE] SBL Total Time Taken             :      51904us</div>
<div class="line"> </div>
<div class="line">Image loading done, switching to application ...</div>
<div class="line">Starting RTOS/Baremetal applications</div>
<div class="line">[IPC RPMSG ECHO] Remote Core waiting for messages from main core ... !!!</div>
<div class="line">[IPC RPMSG ECHO] Received and echoed 10 messages ... !!!</div>
<div class="line">All tests have passed!!</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- HTML footer for doxygen 1.8.11-->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.20 </li>
  </ul>
</div>
</body>
</html>
